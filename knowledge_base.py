"""
知识库模块，提供医疗知识和指导建议
"""

# 透析相关术语标准化映射
TERMINOLOGY_MAPPING = {
    # 症状标准化
    "头晕": "头晕",
    "头昏": "头晕",
    "头昏脑涨": "头晕",
    "恶心": "恶心",
    "想吐": "恶心",
    "呕吐": "呕吐",
    "乏力": "乏力",
    "无力": "乏力",
    "疲劳": "乏力",
    "没劲": "乏力",
    "肌肉痉挛": "肌肉痉挛",
    "抽筋": "肌肉痉挛",
    "腿抽筋": "肌肉痉挛",
    
    # 体征标准化
    "体重": "体重",
    "血压": "血压",
    "压力": "血压",
    "内瘘": "内瘘",
    "动静脉瘘": "内瘘",
    "瘘管": "内瘘",
    
    # 检验值标准化
    "血红蛋白": "血红蛋白",
    "血红": "血红蛋白",
    "Hb": "血红蛋白",
    "肌酐": "肌酐",
    "肌酐酸": "肌酐",
    "Cr": "肌酐",
    "尿素氮": "尿素氮",
    "尿素": "尿素氮",
    "BUN": "尿素氮",
    "血钾": "血钾",
    "钾": "血钾",
    "K": "血钾",
    "K+": "血钾"
}

# 缺口对应的指导建议
GAP_GUIDANCE = {
    # 必填字段缺失
    "缺少透析器型号记录": "请补充透析器型号记录，这对评估透析充分性和生物相容性至关重要。",
    "缺少血流量记录": "请补充血流量记录，这是评估透析效率的重要参数。",
    "缺少透析液流量记录": "请补充透析液流量记录，这影响溶质清除和电解质平衡。",
    "缺少抗凝剂记录": "请补充抗凝剂种类记录，这对评估出血风险和透析器凝血风险很重要。",
    "缺少抗凝剂剂量记录": "请补充抗凝剂剂量记录，剂量不当可能导致出血或凝血并发症。",
    "缺少透析时间记录": "请补充透析时间记录，这是计算透析剂量(Kt/V)的必要参数。",
    "缺少超滤量记录": "请补充超滤量记录，这对评估容量管理和预防低血压至关重要。",
    "缺少透析前体重记录": "请补充透析前体重记录，这是计算超滤量的基础数据。",
    "缺少透析后体重记录": "请补充透析后体重记录，这用于验证实际超滤量和评估干体重达成情况。",
    "缺少透析前血压记录": "请补充透析前血压记录，这是评估血压控制和透析风险的基础数据。",
    "缺少透析后血压记录": "请补充透析后血压记录，这用于评估透析中血压稳定性和后续处理方案。",
    "缺少内瘘评估记录": "请补充内瘘评估记录，包括杂音、震颤等，这对预防内瘘并发症至关重要。",
    "缺少并发症记录": "请补充透析相关并发症记录，若无并发症也请明确记录'无并发症'。",
    
    # 逻辑规则违反
    "记录了体重变化但缺少超滤量记录": "请补充超滤量记录，并确保与体重变化基本一致。体重变化与超滤量不一致可能提示测量误差或隐匿性水肿。",
    "记录了抗凝剂但缺少剂量记录": "请补充抗凝剂剂量记录，抗凝剂使用必须有明确的剂量记录以确保安全。",
    "透析时间不在合理范围内": "请核实透析时间记录是否准确，常规透析时间通常在2-6小时范围内，过短可能影响透析充分性，过长可能增加并发症风险。"
}

# 症状相关的医学知识和建议
SYMPTOM_KNOWLEDGE = {
    "头晕": {
        "可能原因": ["透析中低血压", "透析失衡综合征", "贫血", "电解质紊乱"],
        "建议处理": "记录发生时间（透析前/中/后），测量血压，评估超滤速率，必要时减慢超滤速率或补充白蛋白/生理盐水。"
    },
    "恶心呕吐": {
        "可能原因": ["透析中低血压", "透析失衡综合征", "高钙血症", "尿毒症"],
        "建议处理": "评估透析参数设置，检查电解质水平，必要时调整透析液钙浓度或减慢透析速率。"
    },
    "肌肉痉挛": {
        "可能原因": ["快速超滤", "低钠透析液", "低钙血症", "低镁血症"],
        "建议处理": "评估干体重设置是否合理，检查电解质水平，考虑调整透析液钠浓度或补充电解质。"
    },
    "低血压": {
        "可能原因": ["超滤过快", "干体重设置过低", "自主神经病变", "心功能不全"],
        "建议处理": "减慢超滤速率，考虑分次透析，评估干体重设置，必要时使用升压药物。"
    }
}

def get_knowledge_base():
    """获取完整的知识库"""
    return {
        "terminology_mapping": TERMINOLOGY_MAPPING,
        "gap_guidance": GAP_GUIDANCE,
        "symptom_knowledge": SYMPTOM_KNOWLEDGE
    }
